.col-md-3
  #wrapper
    =render 'users/profile'
.col-md-6
  = render 'layouts/messages'
  .panel.post
    -if @user.present?
      %h4 post something
      =form_for @block, :url => blocks_path, :html => { :multipart => true } do |f|
        .form-group
          =f.text_area :body, :class => 'form-control'
          =f.hidden_field :user_id, value: @user.id
          .form-group.pad-top-1
            =label_tag( 'block[image]', "", :class => 'btn btn-primary') do
              .fa.fa-camera-retro.fa-lg
            =f.file_field :image, :class => 'hide'
            = button_tag(:type => 'submit', :class => 'btn btn-default') do
              Post
              .fa.fa-share
    -else
      %h5 log in to post
  %table
    %tbody
      -@blocks.order(:cached_votes_up).reverse.each do |block|
        -poster = User.find(block.user_id)
        %tr
          .block.panel
            .row
              .col-xs-1.block-user-name
                =link_to "#{poster.name}", user_path(poster.id)
              .col-xs-1
                %p=""
              .col-xs-1
                ="-"
              .col-xs-8
                %p="#{time_ago_in_words(block.created_at)} ago"
              
            .row
              .col-xs-12
                -if block.image.present?
                  .block-image{"data-target" => ".modal_#{block.id}", "data-toggle" => "modal"}
                    =image_tag block.image.url(:medium)
                  .modal.fade.bs-example-modal-lg{class: "modal_#{block.id}","aria-hidden" => "true", "aria-labelledby" => "myLargeModalLabel", role: "dialog", tabindex: "-1"}
                    .modal-dialog.modal-lg
                      .modal-content
                        =image_tag block.image.url
            .row
              .col-xs-12
                %p=block.body
            .row
              .col-xs-1  
                %p="#{block.get_upvotes.size}"
              .col-xs-5
                = link_to upvote_block_path(block), method: :put do
                  .fa.fa-chevron-up
                |
                = link_to downvote_block_path(block), method: :put do
                  .fa.fa-chevron-down
              .col-xs-3.pull-right
                -if @user.present? && block.user_id = @user.id
                  = link_to edit_block_path(block) do
                    .fa.fa-edit
                  = link_to block, :method => :delete, :data => { :confirm => 'Delete permanently?' } do
                    .fa.fa-times-circle-o 
            .row
              .col-xs-12
                -if block.comments.present?
                  .panel-group{:id => "#accordian"}
                    .panel.panel-default
                      .panel-heading
                        %h4.panel-title
                          %a.accordion-toggle{"data-parent" => "#accordion", "data-toggle" => "collapse-next"}
                            Comments ...
                      .panel-collapse.collapse{:id => "#collapse#{block.id}"}
                        .panel-body
                          -block.comments.each do |comment|
                            .row
                              .col-xs-9
                                %p=comment.body
                              .col-xs-2
                                =link_to "#{comment.user.name}", user_path(comment.user.id)
            .row
              .col-xs-12
                -if @user.present?
                  =form_for @comment do |f|
                    .form-group
                      =f.text_area :body, :class => 'form-control'
                      =f.hidden_field :block_id, value: block.id
                      =f.hidden_field :user_id, value: current_user.id
                    .form-group.pad-top-1
                      = button_tag(:type => 'submit', :class => 'btn btn-default') do
                        comment
                        .fa.fa-share

.col-md-3

:javascript
$(function () {
  $('.panel-collapse').collapse({toggle: false});

  $('body').on('click', '[data-toggle=collapse-next]', function (e) {
    var parent_id = $(this).data('parent');
    $(parent_id+' .panel-collapse').collapse('hide');

    var $target = $(this).parents('.panel').find('.panel-collapse');
    $target.collapse('toggle');
  });
});
